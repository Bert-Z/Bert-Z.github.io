---
title: 线程安全相关
date: 2020-07-27 01:12:22
tags: Thread-safe
categories:
cover: https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRGgwOsx3UW-BNAUo7p770__27WOKfa-OUXnQ&usqp=CAU
---
<meta name="referrer" content="no-referrer" />

## 定义

- 多个线程同时访问时，其表现出争取的行为。
- 无论操作系统如何调度这些线程，无论这些线程的执行顺序如何交织。
- 调用端代码无须额外的同步或其他协调动作。



## 可重入 vs 不可重入

可重入函数也可以这样理解，重入即表示重复进入，首先它意味着这个函数可以被中断，其次意味着它除了使用自己栈上的变量以外不依赖于任何环境（包括static），这样的函数就是purecode（纯代码）可重入，可以允许有多个该函数的副本在运行，由于它们使用的是分离的栈，所以不会互相干扰。如果确实需要访问全局变量（包括static），一定要注意实施互斥手段。可重入函数在并行运行环境中非常重要，但是一般要为访问全局变量付出一些性能代价。

而不可重入的函数由于使用了一些系统资源，比如全局变量区，中断向量表等，所以它如果被中断的话，可能会出现问题，这类函数是不能运行在多任务环境下的。



## 对象创建很简单

对象构造要做到线程安全，唯一的要求是在构造期间不要泄露this指针，即

- 不要在构造函数中注册任何回调；
- 也不要在构造函数中把this传给跨线程的对象；
- 即便在构造函数的最后一行也不行。